flowchart TD
    %% ДЕТАЛЬНАЯ ДИАГРАММА ДЕЯТЕЛЬНОСТИ - ОНЛАЙН ПОКЕР
    %% Основана на функциональных требованиях и детальном разборе действий

    Start([Старт игры]) --> Auth{Пользователь авторизован?}
    
    %% АВТОРИЗАЦИЯ И РЕГИСТРАЦИЯ
    Auth -->|Нет| Login[Ввод логина/пароля]
    Login --> LoginCheck{Проверка данных}
    LoginCheck -->|Неверно| LoginError[Показать ошибку]
    LoginError --> Login
    LoginCheck -->|Верно| AuthSuccess[Авторизация успешна]
    
    Auth -->|Нет| Register[Регистрация нового пользователя]
    Register --> RegForm[Заполнить форму регистрации]
    RegForm --> RegValidation{Валидация данных}
    RegValidation -->|Ошибка| RegError[Показать ошибки]
    RegError --> RegForm
    RegValidation -->|Успех| CreateAccount[Создать аккаунт]
    CreateAccount --> AuthSuccess
    
    Auth -->|Да| MainMenu[Главное меню]
    AuthSuccess --> MainMenu
    
    %% ГЛАВНОЕ МЕНЮ
    MainMenu --> MenuChoice{Выбор в меню}
    
    %% ВЫБОР СТОЛА
    MenuChoice -->|Выбор стола| TableList[Показать список столов]
    TableList --> TableFilter[Фильтрация столов]
    TableFilter --> TableSelect[Выбор конкретного стола]
    TableSelect --> TableCheck{Стол доступен?}
    TableCheck -->|Нет| TableList
    TableCheck -->|Да| JoinTable[Подключение к столу]
    
    %% НАСТРОЙКИ
    MenuChoice -->|Настройки| Settings[Открыть настройки]
    Settings --> SettingsChange[Изменение параметров]
    SettingsChange --> SettingsSave[Сохранить настройки]
    SettingsSave --> MainMenu
    
    %% ЛИДЕРБОРД
    MenuChoice -->|Лидерборд| Leaderboard[Показать рейтинг игроков]
    Leaderboard --> MainMenu
    
    %% ПОПОЛНЕНИЕ БАЛАНСА
    MenuChoice -->|Пополнение| TopUp[Пополнение баланса]
    TopUp --> PaymentMethod[Выбор способа оплаты]
    PaymentMethod --> PaymentProcess[Обработка платежа]
    PaymentProcess --> PaymentResult{Платеж успешен?}
    PaymentResult -->|Нет| PaymentError[Ошибка платежа]
    PaymentError --> TopUp
    PaymentResult -->|Да| UpdateBalance[Обновить баланс]
    UpdateBalance --> MainMenu
    
    %% КАСТОМИЗАЦИЯ КАРТ
    MenuChoice -->|Кастомизация| CardCustom[Настройка карт]
    CardCustom --> CardSelect[Выбор дизайна карт]
    CardSelect --> CardSave[Сохранить настройки]
    CardSave --> MainMenu
    
    %% ПРОФИЛЬ ИГРОКА
    MenuChoice -->|Профиль| PlayerProfile[Открыть профиль]
    PlayerProfile --> ProfileEdit[Редактирование профиля]
    ProfileEdit --> ProfileSave[Сохранить изменения]
    ProfileSave --> MainMenu
    
    %% СПИСОК ДРУЗЕЙ
    MenuChoice -->|Друзья| FriendsList[Список друзей]
    FriendsList --> FriendAction{Действие с другом}
    FriendAction -->|Добавить| AddFriend[Добавить друга]
    FriendAction -->|Удалить| RemoveFriend[Удалить друга]
    FriendAction -->|Пригласить| InviteFriend[Пригласить в игру]
    AddFriend --> FriendsList
    RemoveFriend --> FriendsList
    InviteFriend --> FriendsList
    
    %% ВЫХОД
    MenuChoice -->|Выход| Exit[Выход из игры]
    Exit --> End([Конец])
    
    %% ИГРОВОЙ ПРОЦЕСС
    JoinTable --> TableLoad[Загрузка игрового стола]
    TableLoad --> TableDisplay[Отображение стола]
    TableDisplay --> GameStart{Достаточно игроков?}
    GameStart -->|Нет| WaitPlayers[Ожидание игроков]
    WaitPlayers --> GameStart
    GameStart -->|Да| HandStart[Начало раздачи]
    
    %% НАЧАЛО РАЗДАЧИ
    HandStart --> DeterminePositions[Определить позиции игроков]
    DeterminePositions --> SetDealer[Установить кнопку дилера]
    SetDealer --> SetBlinds[Установить позиции блайндов]
    SetBlinds --> PostBlinds[Внести блайнды]
    PostBlinds --> DealHoleCards[Раздать карманные карты]
    DealHoleCards --> PreflopStart[Начало префлопа]
    
    %% ПРЕФЛОП
    PreflopStart --> PreflopAction[Действия игроков на префлопе]
    PreflopAction --> PreflopCheck{Все игроки сделали ход?}
    PreflopCheck -->|Нет| NextPlayerPreflop[Ход следующего игрока]
    NextPlayerPreflop --> PreflopAction
    PreflopCheck -->|Да| PreflopEnd{Остался один игрок?}
    PreflopEnd -->|Да| HandEnd[Завершение раздачи]
    PreflopEnd -->|Нет| FlopDeal[Открыть флоп]
    
    %% ФЛОП
    FlopDeal --> BurnCard1[Сжечь одну карту]
    BurnCard1 --> ShowFlop[Показать 3 карты флопа]
    ShowFlop --> ResetBet[Сбросить текущую ставку]
    ResetBet --> FlopAction[Действия игроков на флопе]
    FlopAction --> FlopCheck{Все игроки сделали ход?}
    FlopCheck -->|Нет| NextPlayerFlop[Ход следующего игрока]
    NextPlayerFlop --> FlopAction
    FlopCheck -->|Да| FlopEnd{Остался один игрок?}
    FlopEnd -->|Да| HandEnd
    FlopEnd -->|Нет| TurnDeal[Открыть тёрн]
    
    %% ТЁРН
    TurnDeal --> BurnCard2[Сжечь одну карту]
    BurnCard2 --> ShowTurn[Показать карту тёрна]
    ShowTurn --> ResetBet2[Сбросить текущую ставку]
    ResetBet2 --> TurnAction[Действия игроков на тёрне]
    TurnAction --> TurnCheck{Все игроки сделали ход?}
    TurnCheck -->|Нет| NextPlayerTurn[Ход следующего игрока]
    NextPlayerTurn --> TurnAction
    TurnCheck -->|Да| TurnEnd{Остался один игрок?}
    TurnEnd -->|Да| HandEnd
    TurnEnd -->|Нет| RiverDeal[Открыть ривер]
    
    %% РИВЕР
    RiverDeal --> BurnCard3[Сжечь одну карту]
    BurnCard3 --> ShowRiver[Показать карту ривера]
    ShowRiver --> ResetBet3[Сбросить текущую ставку]
    ResetBet3 --> RiverAction[Действия игроков на ривере]
    RiverAction --> RiverCheck{Все игроки сделали ход?}
    RiverCheck -->|Нет| NextPlayerRiver[Ход следующего игрока]
    NextPlayerRiver --> RiverAction
    RiverCheck -->|Да| RiverEnd{Остался один игрок?}
    RiverEnd -->|Да| HandEnd
    RiverEnd -->|Нет| Showdown[Шоудаун]
    
    %% ШОУДАУН И ЗАВЕРШЕНИЕ
    Showdown --> RevealCards[Раскрыть карты игроков]
    RevealCards --> CalculateHands[Вычислить комбинации]
    CalculateHands --> CompareHands[Сравнить комбинации]
    CompareHands --> DetermineWinner[Определить победителя]
    DetermineWinner --> DistributePot[Распределить банк]
    
    HandEnd --> DistributePot
    DistributePot --> UpdateStacks[Обновить стеки игроков]
    UpdateStacks --> UpdateStats[Обновить статистику]
    UpdateStats --> LogHand[Записать историю раздачи]
    LogHand --> MoveDealer[Сместить кнопку дилера]
    MoveDealer --> NewHand{Новая раздача?}
    NewHand -->|Да| HandStart
    NewHand -->|Нет| LeaveTable[Покинуть стол]
    LeaveTable --> MainMenu
    
    %% ДЕТАЛИЗАЦИЯ ДЕЙСТВИЙ ИГРОКА
    PreflopAction --> PlayerChoice{Выбор действия}
    PlayerChoice -->|Fold| FoldAction[Сбросить карты]
    PlayerChoice -->|Check| CheckAction[Проверить]
    PlayerChoice -->|Call| CallAction[Уравнять ставку]
    PlayerChoice -->|Raise| RaiseAction[Поднять ставку]
    PlayerChoice -->|All-in| AllInAction[Ва-банк]
    
    FoldAction --> PreflopCheck
    CheckAction --> PreflopCheck
    CallAction --> PreflopCheck
    RaiseAction --> PreflopCheck
    AllInAction --> PreflopCheck
    
    %% Аналогично для других раундов
    FlopAction --> PlayerChoice2{Выбор действия}
    PlayerChoice2 -->|Fold| FoldAction2[Сбросить карты]
    PlayerChoice2 -->|Check| CheckAction2[Проверить]
    PlayerChoice2 -->|Call| CallAction2[Уравнять ставку]
    PlayerChoice2 -->|Raise| RaiseAction2[Поднять ставку]
    PlayerChoice2 -->|All-in| AllInAction2[Ва-банк]
    
    FoldAction2 --> FlopCheck
    CheckAction2 --> FlopCheck
    CallAction2 --> FlopCheck
    RaiseAction2 --> FlopCheck
    AllInAction2 --> FlopCheck
    
    %% ОБРАБОТКА ОШИБОК И ИСКЛЮЧЕНИЙ
    PlayerChoice -->|Тайм-аут| TimeoutAction[Автоматическое действие]
    TimeoutAction --> AutoDecision{Авто-решение}
    AutoDecision -->|Check| CheckAction
    AutoDecision -->|Fold| FoldAction
    
    %% СИСТЕМНЫЕ ПРОВЕРКИ
    CallAction --> ValidateAction[Валидация действия]
    RaiseAction --> ValidateAction
    AllInAction --> ValidateAction
    ValidateAction --> ActionValid{Действие валидно?}
    ActionValid -->|Нет| ShowError[Показать ошибку]
    ShowError --> PlayerChoice
    ActionValid -->|Да| ProcessAction[Обработать действие]
    ProcessAction --> PreflopCheck
    
    %% ОБНОВЛЕНИЕ ИНТЕРФЕЙСА
    ProcessAction --> UpdateUI[Обновить интерфейс]
    UpdateUI --> UpdatePot[Обновить банк]
    UpdatePot --> UpdateStacks[Обновить стеки]
    UpdateStacks --> PreflopCheck
    
    %% СТИЛИЗАЦИЯ
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:3px
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef userAction fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef systemAction fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    
    class Start,End startEnd
    class MainMenu,TableList,Settings,Leaderboard,TopUp,CardCustom,PlayerProfile,FriendsList process
    class Auth,LoginCheck,RegValidation,TableCheck,PaymentResult,GameStart,MenuChoice decision
    class Login,Register,TableSelect,SettingsChange,PlayerChoice,PlayerChoice2 userAction
    class AuthSuccess,CreateAccount,JoinTable,HandStart,DeterminePositions,DealHoleCards systemAction
